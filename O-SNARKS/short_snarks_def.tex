\section{O-SNARKs}
\label{sec:short_snarks_defs}
In the following, we remind the reader the definition of an O-SNARK from~\cite{O_SNARK} and we prove that 
SNARKs such as PLONK~\cite{plonk}, Marlin~\cite{marlin} or Groth16~\cite{groth16} on which a flurry of 
both under development or in production practical applications are based, fulfil this definition for a commonly occurying 
and well-defined class of oracles. In order to do that, we start with a couple of building block definitions: we give a 
reminder of algebraic algorithms (see, for example~\cite{AGM_model}) and introduce our new notion of AGM respecting oracles. \\

\noindent Let $\mathbb{G}$ be a cyclic group of prime order $p$. Informally, an algorithm $A$ is algebraic with respect to 
$\mathbb{G}$ if it fulfils the following requirement: whenever $A$ outputs a group element $h \in \mathbb{G}$, 
it also outputs a representation $(s_1, \ldots, s_t) \in \mathbb{Z}^{t}_p$ 
such that $h = \sum_ {i =1}^t s_i \cdot g_i$, where $(g_1,...,g_t)$ is the list of all group elements that were given to $A$ during its execution so far. \\

\noindent It is easy to see that the property above is equivalent to $A$ outputting  representation $(v_1, \ldots, v_l) \in \mathbb{Z}^{l}_p$ 
such that $h = \sum_ {i =1}^l v_i \cdot g_i$, where $(g_1,...,g_l)$ is the list of all group elements that were given to $A$ as input. \\

\noindent Let $\mathcal{R}$ be an NP relation, i.e., there exists a random access machine $M$ and a polynomial $t$ 
such that  $(x,w) \in \mathcal{R}$ if and only if $M(x,w)$ outputs $1$ after at most $t(\lambda)$ steps and 
$|x| \leq t(\lambda)$, $|w| \leq t(\lambda)$, where by $|x|$, $|w|$ we denote the length of the public input $x$ 
and of the witness $w$, respectively. We denote $\mathcal{L}_{\mathcal{R}} = \{ x\  | \ \exists \ w,  (x, w) \in \mathcal{R} \}$.  
Finally, by $|M|$ we denote the upper bound (in the security parameter $\lambda$) 
of the time taken by $M$ to output $1$ on input $(x,w) \in \mathcal{R}$.\\

\noindent Let $\mathbb{O} = \{ \mathcal{O} \}_{i \in \mathcal{I}}$ be a family of oracles. We denote by $\mathcal{O} \leftarrow \mathbb{O}$ 
the process of sampling an oracle $\mathcal{O}$ from the family $\mathbb{O}$ according to some (possibly probabilistic) process.
$\mathbb{O}$ can be a random oracle family or a signing oracle corresponding to a signature scheme. For any oracle family 
$\mathbb{O}$, we define an O-SNARK $\Pi$ for $\mathbb{O}$ as follows~\cite{O_SNARK}. \\

\begin{comment}
%\begin{definition}[(O-)SNARKs]
%\label{def:osnarks}
%We say $\Pi$ is a $\mathcal{Z}$-auxiliary input (O-)SNARK (for the oracle family $\mathbb{O})$, 
%if $\Pi$ satisfies the properties of completeness and 
%succinctness as in Definition above {\color{red} ADD THAT} 
%and the following property of adaptive proof of knowledge for $\mathbb{O}$:
%Consider the following experiment for security parameter $\lambda \in \mathbb{N}$, 
%time bound $T \in \mathbb{N}$, adversary $\mathcal{A}$, extractor $\mathcal{E}_{\mathcal{A}}$, 
%auxiliary input generator $\mathcal{Z}$ and oracle family $\mathbb{O}$:\\

%\begin{align*}
%O-AddaptivePoK&(\lambda, T, A, E_A, \mathcal{Z}, \mathbb{O}): \\
%& \mathit{aux} \leftarrow \mathcal{Z}(1^{\lambda}); \mathcal{O} \leftarrow \mathbb{O}; \mathsf{crs} \leftarrow \mathsf{Gen}(1^{\lambda},T); \\
%& (y,\pi) \leftarrow A^{\mathcal{O}}(\mathsf{crs},\mathit{aux}); w \leftarrow E_A(\mathsf{crs}, \mathit{aux}, \mathsf{qt}); \\
%& if \ \mathsf{Ver}(\mathsf{crs}, y, \pi) = 1 \wedge (y,w) \in R \ return  \ 1 \\
%& else \ return \ 0
%\end{align*}
%\noindent where $\mathsf{qt} = \{q_i, \mathcal{O}(q_i)\}$ is the transcript of all the oracle queries and answers made and received by $A$ during its execution. 

%$\Pi$ satisfies adaptive proof of knowledge with respect to oracle family  $\mathbb{O}$ and auxiliary input from $\mathcal{Z}$ 
%if for every non-uniform oracle prover $A^{\mathcal{O}}$ of sizes $s(\lambda)= \mathsf{poly}(\lambda)$ making at most 
%$Q(\lambda) = \mathsf{poly}(\lambda)$ queries there exists a non-uniform extractor
%$E_A$ of size $t(\lambda)=\mathsf{poly}(\lambda)$ and a negligible function $\mathsf{negl}(\lambda)$ 
%such that for every time bound $T$, 
%$$\mathsf{Pr}[ \mathit{O-AddaptivePoK}(\lambda, T, A, E_A, \mathcal{Z}, \mathcal{O})  \implies  1]\ \leq \mathsf{negl}(\lambda).$$
%\end{definition} 
\end{comment}

\begin{definition}[$\mathcal{Z}$-auxiliary input (O-)SNARK (for oracle family $\mathbb{O}$)]
\label{def:osnarks}
%A succinct non-interactive argument of knowledge (SNARK) for a relation $\mathcal{R}$ is a triple of algorithms 
A $\mathcal{Z}$-auxiliary input with oracle access succinct non-interactive argument of knowledge for a relation $\mathcal{R}$ 
is a triple of algorithms $\Pi=(\mathsf{Gen}, \mathsf{Prove}, \mathsf{Verify})$ working as follows:
\begin{itemize}
\item $\mathsf{Gen}(1^{\lambda},\mathcal{R}) \rightarrow \mathsf{crs}:$ 
on input a security parameter $\lambda \in \mathbb{N}$, the generation algorithm outputs
a common reference string $\mathsf{crs} = (\mathit{prs},\mathit{vrs})$ 
consisting of a public pair of prover reference string $\mathit{prs}$ and a verification state $\mathit{vrs}$;
\item $\mathsf{Prove}(\mathsf{crs}, x, w, \mathcal{R}) \rightarrow \pi:$ the proving algorithm takes as input 
a common reference string $\mathsf{crs}$ and a pair $(x,w) \in \mathcal{R}$ and returns a proof $\pi$. 
\item $\mathsf{Verify}(\mathsf{crs}, x, \pi, \mathcal{R}) \rightarrow 0/1:$ the verification algorithm takes as input 
a common reference string $\mathsf{crs}$, some public input $x$ and an alleged proof $\pi$ and if it accepts, 
it outputs 1 and if it rejects, it outputs 0. 
\end{itemize}
\noindent that fulfils perfect completeness, succinctness and (oracle access) adaptive knowledge soundness (for oracle family $\mathbb{O}$) as defined below.

\paragraph{Perfect completeness:} For every $(x,w) \in \mathcal{R}$ we have
$$\mathit{Pr}[ \mathsf{Verify}(\mathsf{crs}, x, \pi, \mathcal{R})=1 \  | \  \mathsf{Gen}(1^{\lambda},\mathcal{R}) \rightarrow \mathsf{crs} \ \wedge \  \mathsf{Prove}(\mathsf{crs}, x, w, \mathcal{R}) \rightarrow \pi ] = 1. $$

\paragraph{Succinctness:} For every large enough security parameter $\lambda \in \mathbb{N}$ 
and every $x \in \mathcal{L}_{\mathcal{R}}$, we have that 
$\mathsf{Gen}$ runs in $\mathsf{poly}(\lambda)$ time, $\mathsf{Prove}$ runs in $\mathsf{poly}(\lambda + |M|+ |x|)$ time,  
$\mathsf{Verify}$ runs in $\mathsf{poly}(\lambda + |x|)$ time and an honestly generated proof has size $\mathsf{poly}(\lambda)$. 
\paragraph{Adaptive knowledge soundness:} Consider the following experiment for security 
parameter $\lambda \in \mathbb{N}$, adversary $\mathcal{A}$, extractor $\mathcal{E}_{\mathcal{A}}$, auxiliary 
input generator $\mathcal{Z}$ :\\
\begin{align*}
\mathit{AddaptPoK}&(\lambda, \mathcal{A}, \mathcal{E}_{\mathcal{A}}, \mathcal{Z}): \\
& \mathsf{aux} \leftarrow \mathcal{Z}(1^{\lambda}); \mathsf{crs} \leftarrow \mathsf{Gen}(1^{\lambda}); \\
& (y,\pi) \leftarrow \mathcal{A}(\mathsf{crs},\mathsf{aux}); w \leftarrow \mathcal{E}_{\mathcal{A}}(\mathsf{crs}, \mathsf{aux}); \\
& if \ \mathsf{Verify}(\mathsf{crs}, y, \pi) = 1 \wedge (y,w) \in R \ return  \ 1 \\
& else \ return \ 0
\end{align*}
\noindent $\Pi$ satisfies adaptive proof of knowledge soundness with respect to auxiliary input from $\mathcal{Z}$ if 
for every non-uniform oracle prover $\mathcal{A}$ making at most 
$Q(\lambda) = \mathsf{poly}(\lambda)$ queries there exists a non-uniform extractor $\mathcal{E}_{\mathcal{A}}$ 
and a negligible function $\mathsf{negl}(\lambda)$ such that 
$$\mathsf{Pr}[\mathit{AddaptPoK}(\lambda, \mathcal{A}, \mathcal{E}_{\mathcal{A}}, \mathcal{Z}) \implies  1]\ \leq \mathsf{negl}(\lambda).$$

\paragraph{Oracle-access adaptive knowledge soundness for oracle family $\mathbb{O}$:} Consider the following experiment for security 
parameter $\lambda \in \mathbb{N}$, adversary $\mathcal{A}$, extractor $\mathcal{E}_{\mathcal{A}}$, auxiliary 
input generator $\mathcal{Z}$ and oracle family $\mathbb{O}$:\\
\begin{align*}
\mathit{OAddaptPoK}&(\lambda, \mathcal{A}, \mathcal{E}_{\mathcal{A}}, \mathcal{Z}, \mathbb{O}): \\
& \mathsf{aux} \leftarrow \mathcal{Z}(1^{\lambda}); \mathcal{O} \leftarrow \mathbb{O}; \mathsf{crs} \leftarrow \mathsf{Gen}(1^{\lambda}); \\
& (y,\pi) \leftarrow \mathcal{A}^{\mathcal{O}}(\mathsf{crs},\mathsf{aux}); w \leftarrow \mathcal{E}_{\mathcal{A}}(\mathsf{crs}, \mathsf{aux}, \mathsf{qt}); \\
& if \ \mathsf{Verify}(\mathsf{crs}, y, \pi) = 1 \wedge (y,w) \in R \ return  \ 1 \\
& else \ return \ 0
\end{align*}
\noindent where $\mathsf{qt} = \{q_i, \mathcal{O}(q_i)\}$ is the transcript of all the oracle queries and answers made and received by 
$\mathcal{A}$ during its execution. $\Pi$ satisfies oracle-access adaptive proof of knowledge with respect to oracle family  $\mathbb{O}$ and auxiliary 
input from $\mathcal{Z}$ if for every non-uniform oracle prover $\mathcal{A}^{\mathcal{O}}$  
making at most $Q(\lambda) = \mathsf{poly}(\lambda)$ queries there exists a non-uniform extractor $\mathcal{E}_{\mathcal{A}}$ 
and a negligible function $\mathsf{negl}(\lambda)$ such that 
$$\mathsf{Pr}[\mathit{OAddaptPoK}(\lambda, \mathcal{A}, \mathcal{E}_{\mathcal{A}}, \mathcal{Z}, \mathcal{O}) \implies  1]\ \leq \mathsf{negl}(\lambda).$$ 
\end{definition} 

\begin{definition}[AGM Respecting Oracles]
\label{def:agm_oracles}
Let $\mathbb{G}$ be a cyclic group of prime order $p$ and let $\mathcal{A}$ be the set of all algebraic adversaries with 
respect to $\mathbb{G}$. We say that a family of oracles $\mathbb{O}$ is AGM respecting relative to $\mathbb{G}$ if 
the probability of any oracle $\mathcal{O} \in \mathbb{O}$ to perform a group operation from $\mathbb{G}$ 
(i.e., output an element of $\mathbb{G}$) is $0$. 
\end{definition}

\begin{theorem}[O-SNARKS for AGM Respecting Oracles]
\label{the:when_osnarks} 
Let $\mathbb{G}$ be a cyclic group of prime order $p$ and let $\mathbb{O}$ be an AGM respecting oracle 
relative to $\mathbb{G}$ as per Definition~\ref{def:agm_oracles}. We denote by $\mathcal{Z}_{\mathbb{O}}$ the 
probability distribution of all the public parameters that define a member of $\mathbb{O}$ together with some 
polynomial number $Q$ of queries and answers to $\mathbb{O}$. More formally: 
$\mathcal{Z}_{\mathbb{O}} = (\mathit{pp}, \{\mathcal{O}(q_i), q_i\}_{i=1}^Q)$, $Q = \mathsf{poly}(\lambda)$, $(\mathit{pp}, \mathcal{O}) \leftarrow \mathbb{O}$. 
Then every $\mathcal{Z}_{\mathbb{O}}$-auxiliary input SNARK $\Pi$ secure in the AGM model with respect to $\mathbb{G}$ is an O-SNARK for $\mathbb{O}$.
\end{theorem}

\begin{proof}{\color{red} TO DO}
\end{proof}


